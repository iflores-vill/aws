---
- inventory: Test_VM
  gather_facts: False
  #connection: local
  tasks:
    - name: Generar password/semilla
      shell: date | sha256sum | base64 | head -c 16
      register: pass_sed
      no_log: true
      #listen: "Generar usuarios y comunicar passwords"
  
    - name: Genera el hash 
      shell: openssl passwd -1 -salt "{{ pass_sed.stdout }}" "{{ pass_sed.stdout }}"
      register: user_pass
      no_log: true
      
    #- debug:
        #msg: El password es {{ pass_sed.stdout }} y el hash {{ user_pass.stdout }}
        
    - name: Genera usuario 'adminsenha' y se agrega a grupo wheel
      user:
        name: adminsenha
        shell: /bin/bash
        groups: wheel
        append: yes
        password: "{{ user_pass.stdout }}"
        update_password: always
      register: adduser_adminsenha
      #listen: "Generar usuarios y comunicar passwords"
